%% ===============================================
%% DIAGRAMA DE ARQUITETURA - EQUILIBREINVEST
%% ===============================================
%% OrientaÃ§Ã£o: Vertical (Top-Bottom) para melhor legibilidade
%% Estilos de cor devem ser controlados via arquivo de configuraÃ§Ã£o externo (mermaid.config.js / mermaid-cli.json)

flowchart TB
    %% ===============================================
    %% CAMADA FRONTEND
    %% ===============================================
    subgraph "ğŸ¨ Frontend Layer (Next.js + React)"
        direction TB
        
        %% Core App Components
        AppShell["ğŸ  App Shell<br/><small>Layout Principal</small>"]:::ui
        ThemeProvider["ğŸŒ“ Theme Provider<br/><small>Gerenciamento de Tema</small>"]:::ui
        UIComponents["ğŸ§© UI Components<br/><small>Biblioteca de Componentes</small>"]:::ui

        %% Pages Subgraph
        subgraph "ğŸ“„ Application Pages"
            direction TB
            LoginPage["ğŸ” Login Page<br/><small>AutenticaÃ§Ã£o Google</small>"]:::ui
            CarteiraPage["ğŸ’¼ Carteira Page<br/><small>GestÃ£o de Watchlist</small>"]:::ui
            CalculadoraPage["ğŸ§® Calculadora Page<br/><small>Balanceamento Principal</small>"]:::ui
            RecomendacoesPage["ğŸ’¡ RecomendaÃ§Ãµes Page<br/><small>SugestÃµes IA</small>"]:::ui
            ResultadoPage["ğŸ“Š Resultado Page<br/><small>Resultados & Salvamento</small>"]:::ui
            HistoricoList["ğŸ“ˆ HistÃ³rico List<br/><small>Lista de SimulaÃ§Ãµes</small>"]:::ui
            HistoricoDetail["ğŸ” HistÃ³rico Detail<br/><small>Detalhes da SimulaÃ§Ã£o</small>"]:::ui
            EditarAtivos["âœï¸ Editar Ativos<br/><small>CRUD de AÃ§Ãµes</small>"]:::ui
        end

        %% State Management Subgraph  
        subgraph "ğŸ§  Global State Management"
            direction TB
            AuthContext["ğŸ‘¤ Auth Context<br/><small>Estado de AutenticaÃ§Ã£o</small>"]:::service
            PortfolioContext["ğŸ’° Portfolio Context<br/><small>Estado da Carteira</small>"]:::service
            ThemeContext["ğŸ¨ Theme Context<br/><small>Estado do Tema</small>"]:::service
        end
    end

    %% ===============================================
    %% CAMADA BACKEND/API
    %% ===============================================
    subgraph "âš™ï¸ Backend Layer (API Routes)"
        direction TB
        StockPriceAPI["ğŸ“ˆ Stock Price API<br/><small>/api/stock-price</small>"]:::api
        AIRecAPI["ğŸ¤– AI Recommendation API<br/><small>/api/ai-recommendation</small>"]:::api
    end

    %% ===============================================
    %% CAMADA DE DADOS
    %% ===============================================
    subgraph "ğŸ—„ï¸ Data Layer (Firebase Cloud)"
        direction TB
        FirebaseAuth["ğŸ”’ Firebase Auth<br/><small>AutenticaÃ§Ã£o OAuth</small>"]:::data
        FirestoreDB["ğŸ“š Firestore DB<br/><small>Banco NoSQL</small>"]:::data
    end

    %% ===============================================
    %% SERVIÃ‡OS EXTERNOS
    %% ===============================================
    subgraph "ğŸŒ External Services"
        direction TB
        MarketDataAPI["ğŸ“Š Market Data APIs<br/><small>Alpha Vantage / Yahoo</small>"]:::external
        AIService["ğŸ§  AI Services<br/><small>Hugging Face / OpenAI</small>"]:::external
    end

    %% ===============================================
    %% INFRAESTRUTURA
    %% ===============================================
    subgraph "ğŸ—ï¸ Infrastructure & CI/CD"
        direction TB
        Vercel["ğŸš€ Vercel Deploy<br/><small>Hospedagem & CDN</small>"]:::infra
        GitHubActions["âš¡ GitHub Actions<br/><small>CI/CD Pipeline</small>"]:::infra
    end

    %% ===============================================
    %% FLUXOS DE DADOS PRINCIPAIS
    %% ===============================================
    
    %% AutenticaÃ§Ã£o e Estado Global
    LoginPage -.->|"ğŸ” autenticaÃ§Ã£o"| AuthContext
    AuthContext -.->|"ğŸ“¡ OAuth login"| FirebaseAuth
    ThemeProvider -.->|"ğŸ¨ fornece tema"| ThemeContext
    
    %% GestÃ£o de Carteira
    CarteiraPage -.->|"ğŸ’¾ CRUD aÃ§Ãµes"| FirestoreDB
    CarteiraPage -.->|"ğŸ“ˆ busca preÃ§os"| StockPriceAPI
    EditarAtivos -.->|"âœï¸ edita portfolio"| FirestoreDB
    
    %% Calculadora e RecomendaÃ§Ãµes
    CalculadoraPage -.->|"ğŸ¤– solicita IA"| AIRecAPI
    CalculadoraPage -.->|"ğŸ“Š preÃ§os atuais"| StockPriceAPI
    CalculadoraPage -.->|"â¡ï¸ navega para"| RecomendacoesPage
    RecomendacoesPage -.->|"ğŸ§  processamento"| AIRecAPI
    RecomendacoesPage -.->|"â¡ï¸ navega para"| ResultadoPage
    ResultadoPage -.->|"ğŸ’¾ salva simulaÃ§Ã£o"| FirestoreDB
    
    %% HistÃ³rico e Consultas
    HistoricoList -.->|"ğŸ“š lista simulaÃ§Ãµes"| FirestoreDB
    HistoricoList -.->|"â¡ï¸ navega para"| HistoricoDetail
    HistoricoDetail -.->|"ğŸ” detalhes"| FirestoreDB
    
    %% APIs e ServiÃ§os Externos
    StockPriceAPI -.->|"ğŸ“¡ proxy request"| MarketDataAPI
    AIRecAPI -.->|"ğŸ¤– gera recomendaÃ§Ãµes"| AIService
    
    %% Estrutura da AplicaÃ§Ã£o
    AppShell -.->|"ğŸ—ï¸ envolve"| ThemeProvider
    AppShell -.->|"ğŸ§© usa"| UIComponents
    UIComponents -.->|"ğŸ¨ componentes"| LoginPage
    UIComponents -.->|"ğŸ¨ componentes"| CarteiraPage
    UIComponents -.->|"ğŸ¨ componentes"| CalculadoraPage
    
    %% CI/CD e Infraestrutura
    GitHubActions -.->|"ğŸš€ deploy para"| Vercel

    %% Click Events
    click AppShell "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/app/layout.tsx"
    click ThemeProvider "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/components/theme-provider.tsx"
    click UIComponents "https://github.com/rosanarezende/balanceamento-de-investimentos/tree/main/src/components/ui/"
    click LoginPage "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/app/login/page.tsx"
    click CalculadoraPage "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/app/calculadora-balanceamento/page.tsx"
    click RecomendacoesPage "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/app/calculadora-balanceamento/recomendacoes/page.tsx"
    click ResultadoPage "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/app/calculadora-balanceamento/resultado/page.tsx"
    click HistoricoList "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/app/historico/page.tsx"
    click HistoricoDetail "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/app/historico/[id]/page.tsx"
    click EditarAtivos "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/app/editar-ativos/page.tsx"
    click CarteiraPage "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/app/carteira/page.tsx"
    click AuthContext "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/core/state/auth-context.tsx"
    click PortfolioContext "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/core/state/portfolio-context.tsx"
    click ThemeContext "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/core/state/theme-context.tsx"
    click StockPriceAPI "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/app/api/stock-price/route.ts"
    click AIRecAPI "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/app/api/ai-recommendation/route.ts"
    click FirebaseAuth "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/services/firebase/config.ts"
    click FirestoreDB "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/src/services/firebase/firestore.ts"
    click GitHubActions "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/.github/workflows/ci.yml"
    click Vercel "https://github.com/rosanarezende/balanceamento-de-investimentos/blob/main/next.config.mjs"

    %% ===============================================
    %% ESTILOS BASE COM CORES ESPECÃFICAS
    %% ===============================================
    classDef ui fill:#D0E8FF,stroke:#3399FF,stroke-width:2px,color:#000,font-weight:bold
    classDef service fill:#DFF7D8,stroke:#28A745,stroke-width:2px,color:#000,font-weight:bold
    classDef api fill:#C8F0FF,stroke:#0CA2DB,stroke-width:2px,color:#000,font-weight:bold
    classDef data fill:#FFE8B8,stroke:#E09F3E,stroke-width:2px,color:#000,font-weight:bold
    classDef external fill:#E0E0E0,stroke:#A0A0A0,stroke-width:2px,color:#000,font-weight:bold
    classDef infra fill:#F0E6FF,stroke:#8C41FF,stroke-width:2px,color:#000,font-weight:bold
